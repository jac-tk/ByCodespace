<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWAapp</title>

    <link rel="manifest" id="mymanifest" />
    <!-- <link rel="manifest" href="staticmani.json" /> -->
</head>
<body>
    <script>
        if((params = window.location.search) && (init = (new URLSearchParams(params).get("init")))){
            sessionStorage.setItem("user",init)
            window.location.href = window.location.href.replace(/(?<=\/)[^/]*?$/,"myPWA_home")
        }
    </script>
    <div class="step1">
        input name<input type="text">
        <button onclick="generateEnv(this.previousElementSibling)">OK</button>
    </div>
    <div class="step2" style="display: none;">
        <span>CREATED!</span><br>
        <span>please install</span>
    </div>
</body>
<script>
    function generateEnv(elem){
        if(!elem.value)return alert("未入力！");
        const rootPath = window.location.href.replace(/(?<=\/)[^/]*?$/,""),
                startUrl = window.location.href + "?init=" + elem.value
        const manifest = {
                    "name": "myPWAapplication",
                    "short_name": "myPWA",
                    "theme_color": "blue",
                    "background_color": "gray",
                    "display": "standalone",
                    "start_url": rootPath+"myPWA",
                    "icons": [
                        {
                        "src": rootPath+"tst.png",
                        "sizes": "100x100",
                        "purpose": "any"
                        },
                        {
                            "src": rootPath+"tst2.png",
                            "sizes": "200x200",
                            "purpose": "any"
                        }
                    ],  
                    "screenshots": [
                        {
                        "src": rootPath+"tst32.png",
                        "sizes": "320x320",
                        "purpose": "any",
                        "form_factor": "wide"
                        },
                        {
                            "src": rootPath+"tst32.png",
                            "sizes": "320x320",
                            "purpose": "any",
                            "form_factor": "narrow"
                        }
                    ]
                }
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#mymanifest').setAttribute('href', manifestURL);

        document.querySelector(".step1").style.display="none"
        document.querySelector(".step2").style.display="unset"

        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("mysw.js");
        }

    }
</script>
</html>